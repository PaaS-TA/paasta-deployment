releases:
- name: "os-conf"
  url:  "https://bosh.io/d/github.com/cloudfoundry/os-conf-release?v=22.1.1"
  sha1: "4f653168954749992a541d228dd4f936f2eff2d6"
  version: "22.1.1"

addons:
- include:
    stemcell:
    - os: ubuntu-trusty
    - os: ubuntu-xenial
    - os: ubuntu-bionic
  name: os-configuration
  jobs:
  - name: sysctl
    release: os-conf
    properties:
      sysctl:
      - net.ipv4.tcp_timestamps=0

  - name: pre-start-script
    release: os-conf
    properties:
      script: |-
        #!/bin/bash
        sed -i "$(grep -Rn 'PASS_MAX_DAYS' /etc/login.defs | grep 99999 | awk -F"[:]" '{ print $1 }')s/99999/90/"  /etc/login.defs
        chage -M 90 root
        chage -M 90 vcap

  - name: post-deploy-script
    release: os-conf
    properties:
      script: |-
        #!/bin/bash
        chmod o-w /var/tmp
        echo "linux 18.04 cce enable"
        find / \( -nouser -o -nogroup \) -xdev -exec chown root:root {} \;
        find /sys /var /usr /home /etc /tmp /bin /sbin -type f -perm -2 -exec chmod o-w {} \;

